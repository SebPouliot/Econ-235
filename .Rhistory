dta <- read_excel("Data/7) Cattle weight.xlsx", sheet = "Data sheet (machine readable)") %>%
dplyr::filter(`Time period description` == "Month", Commodity == "Cattle") %>%
dplyr::select(Date, Value, Unit) %>%
mutate(Date = as.Date(Date),
year = year(Date),
Unit = ifelse(Unit == "LB / HEAD, DRESSED BASIS", "Dressed", "Live")) %>%
group_by(Date, Unit) %>%
summarize(Value = mean(Value))
dta
dta %>% spread(Unit, Value)
dta %>% spread(Unit, Value)
dta
dta %>%
spread(Unit, Value)
dta %>% spread(Unit, Value)
dta %>%
spread(Unit, Value) %>%
mutate(yield = Dressed/Live)
plot_yield <- ggplot(weight2, aes(x = Date, y = yield)) +
geom_line(size = 1) +
ylab("Yield") +
scale_x_date(date_breaks = "5 year", date_labels = "%Y") +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.10, 0.90))
dta <- dta %>%
spread(Unit, Value) %>%
mutate(yield = Dressed/Live)
plot_yield <- ggplot(weight2, aes(x = Date, y = yield)) +
geom_line(size = 1) +
ylab("Yield") +
scale_x_date(date_breaks = "5 year", date_labels = "%Y") +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.10, 0.90))
ggplot(dta, aes(x = Date, y = yield)) +
geom_line(size = 1)
plot_yield <- ggplot(dta, aes(x = Date, y = yield)) +
geom_line(size = 1) +
ylab("Yield") +
scale_x_date(date_breaks = "5 year", date_labels = "%Y") +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.10, 0.90))
plot_yield
ggplot(dta, aes(x = Date, y = yield)) +
geom_line(size = 1) +
ylab("Yield") +
scale_x_date(breaks = seq(as.Date("1920-01-01"), as.Date("2020-12-31"), by="10 years"), date_labels = "%Y") +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.10, 0.90))
dta <- read_excel("Data/7) Cattle trade.xls", col_names = FALSE)
dta <- read_excel("Data/7) Cattle trade.xls", col_names = FALSE)
dta <- dta[c(2,34:35),] %>%
dplyr::select(-X__1, -X__2)
colnames(dta) <- c("Country", dta[1,2:ncol(dta)])
dta <- dta[2:3,]
dta
dta %>%
gather(year, value,-Country)
dta %>%
gather(year, value,-Country) %>%
mutate(year = as.numeric(year), value = as.numeric(value)) %>%
replace_na(list(value = 0))
dta <- dta %>%
gather(year, value,-Country) %>%
mutate(year = as.numeric(year), value = as.numeric(value)) %>%
replace_na(list(value = 0))
dta %>% tail
download.file("https://www.ers.usda.gov/webdocs/DataFiles/47913/RHLCowc.xls", "Data/7) Cow-calf return.xls", method = "curl")
read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007")
dta1[c(1,45),]
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1[c(1,45),]
dta1[c(1,42),]
dta1[c(1,43),]
c("Country", dta[1,2:ncol(dta1)])
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[c(1,43),]
c("Country", dta[1,2:ncol(dta1)])
dta1
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[43,]
dta1
dta1[43,] %>%
dplyr::Select(-Item) %>%
t()
dta1[43,] %>%
dplyr::select(-Item) %>%
t()
dta1[43,] %>%
dplyr::select(-Item) %>%
t()
dta1[43,] %>%
dplyr::select(-Item)
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1[43,] %>%
dplyr::select(-Item)
dta1[43,] %>%
dplyr::select(-Item) %>%
t()
colnames(dta) <- c("value")
colnames(dta1) <- c("value")
dta1 %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta1 %>%
mutate(value = as.numeric(value))
dta1
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[43,] %>%
dplyr::select(-Item) %>%
t()
colnames(dta1) <- c("value
dta1 %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[43,] %>%
dplyr::select(-Item) %>%
t()
colnames(dta1) <- c("value")
dta1
dta1 %>%
mutate(value = as.numeric(value))
dta1 %>%
tibble() %>%
mutate(value = as.numeric(value))
dta1 %>%
tibble()
dta1
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[43,]
dta
dta1
dta1[43,] %>%
dplyr::select(-Item) %>%
gather()
dta1[43,] %>%
dplyr::select(-Item) %>%
gather() %>%
tail()
?gather
dta1[43,] %>%
dplyr::select(-Item) %>%
gather(date, value)
dta1[43,] %>%
gather(date, value, -Item)
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1
dta1[43,]
dta1[43,] %>%
gather(date, value, -Item)
dta1[43,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 2, skip = 1)
dta2
dta1[38,]
?read_excel
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 1, skip = 1)
dta1[38,]
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 3, skip = 1)
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 2, skip = 1)
dta1[38,]
dta2[38,]
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 2, skip = 1)
dta2[38,]
dta2[38,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 2, skip = 1)
dta2 <- dta2[38,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta <- rbind(dta1, dta2)
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[43,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 2, skip = 1)
dta2 <- dta2[38,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta <- rbind(dta1, dta2)
dta
ggplot(dta, aes(x = Date, y = Value)) +
geom_bar()
ggplot(dta, aes(x = date, y = Value)) +
geom_bar()
ggplot(dta, aes(x = date, y = value)) +
geom_bar()
geom_bar()
knitr::opts_chunk$set(echo=FALSE, fig.keep='high', out.width = '95%', fig.align = 'center', dev='cairo_pdf', warning = FALSE, message = FALSE)
#Load some packages
library(pacman)
pacman::p_load(tidyverse)
pacman::p_load(lubridate)
pacman::p_load(readxl)
pacman::p_load(Quandl)
pacman::p_load(viridis)
pacman::p_load(Cairo)
options(kableExtra.latex.load_packages = TRUE)
pacman::p_load(kableExtra)
pacman::p_load(ggmap)
pacman::p_load(sp)
pacman::p_load(usmap)
pacman::p_load(maps)
#Authentification
#Quandl.api_key("2xcmYFJoJKuEDwawuV7J")
#Basic setup for figures
source("Figures/Graph parameters.r")
if(Sys.time() - file.info("Data/7) Cow-calf return.xls")$mtime > months(1, abbreviate = FALSE)){
download.file("https://www.ers.usda.gov/webdocs/DataFiles/47913/RHLCowc.xls", "Data/7) Cow-calf return.xls", method = "curl")
}
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[43,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 2, skip = 1)
dta2 <- dta2[38,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta <- rbind(dta1, dta2) %>%
mutate(sign = ifelse(value <= 0, "Negative", "Positive"))
dta
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white")
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_color_viridis(discrete = TRUE)
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE)
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_continuous(breaks = 5)
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_continuous(breaks = seq(1995, 2020, by = 5))
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE)
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_continuous(breaks = seq(1995, 2020, by = 5))
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1995, 2020, by = 5))
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2))
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2))
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_viridis(discrete = TRUE) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
knitr::opts_chunk$set(echo=FALSE, fig.keep='high', out.width = '95%', fig.align = 'center', dev='cairo_pdf', warning = FALSE, message = FALSE)
#Load some packages
library(pacman)
pacman::p_load(tidyverse)
pacman::p_load(lubridate)
pacman::p_load(readxl)
pacman::p_load(Quandl)
pacman::p_load(viridis)
pacman::p_load(Cairo)
options(kableExtra.latex.load_packages = TRUE)
pacman::p_load(kableExtra)
pacman::p_load(ggmap)
pacman::p_load(sp)
pacman::p_load(usmap)
pacman::p_load(maps)
#Authentification
#Quandl.api_key("2xcmYFJoJKuEDwawuV7J")
#Basic setup for figures
source("Figures/Graph parameters.r")
dta1 <- read_excel("Data/7) Cow-calf return.xls", sheet = "Heartland 1996-2007", skip = 1)
dta1 <- dta1[43,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta2 <- read_excel("Data/7) Cow-calf return.xls", sheet = 2, skip = 1)
dta2 <- dta2[38,] %>%
gather(date, value, -Item) %>%
dplyr::select(-Item) %>%
mutate(value = as.numeric(value)) %>%
dplyr::filter(!is.na(value))
dta <- rbind(dta1, dta2) %>%
mutate(sign = ifelse(value <= 0, "Negative", "Positive"))
dta
dta[1:25]
View(dta)
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_manual(viridis(2)[c(1,2)]) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
viridis(2)[c(1,2)]
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_manual(viridis(2)[c(1,2)])
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white")
viridis(2)[c(1,2)]
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_manual(values = viridis(2)[c(1,2)]) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_manual(values = viridis(2)[c(2,3)]) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_manual(values = viridis(3)[c(2,3)]) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
ggplot(dta, aes(x = date, y = value, fill = sign)) +
geom_bar(stat = "identity", color = "white") +
scale_fill_manual(values = viridis(3)[c(1,2)]) +
ylab("Price ($/cwt)") +
scale_x_discrete(breaks = seq(1996, 2020, by = 2)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position="none")
dta <- read_excel("Data/7) Beef and veal exports.xls", col_names = FALSE)
dta <- dta[c(2,97:308),] %>%
dplyr::select(-X__1, -X__2)
colnames(dta) <- c("Country", dta[1,2:ncol(dta)])
dta <- dta[-1,]
dta <- dta %>%
gather(year, value,-Country) %>%
mutate(Country = case_when(Country == "Canada" ~ "Canada",
Country == "Mexico" ~ "Mexico",
Country == "Japan" ~ "Japan",
Country == "South Korea" ~ "South Korea",
Country == "Hong Kong" ~ "Hong Kong",
Country == "China (Taiwan)" ~ "China (Taiwan)",
Country == "Russia" ~ "Russia",
TRUE ~ "Other countries"),
value = as.numeric(value),
year = as.numeric(year)) %>%
replace_na(list(value = 0)) %>%
group_by(Country, year) %>%
summarize(value = sum(value))
beef_export <- ggplot(dta, aes(x = year, y = value, color = Country, fill = Country)) +
geom_area(position = "stack") +
geom_line(position = "stack", size = 0.5, color = "black") +
scale_color_viridis(discrete = TRUE) +
scale_fill_viridis(discrete = TRUE) +
ylab("Imports of beef and veal (carcass weight, 1,000 pounds)") +
scale_x_continuous(breaks = seq(1990, 2015, by = 5)) +
theme_bw() + mytheme +
guides(col = guide_legend(ncol = 2)) +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.15, 0.9),
legend.direction = "vertical",
legend.text=element_text(size=10)) +
expand_limits(x = 0, y = 0)
beef_export
ggplot(dta, aes(x = year, y = value, color = Country, fill = Country)) +
geom_area(position = "stack") +
geom_line(position = "stack", size = 0.5, color = "black") +
scale_color_viridis(discrete = TRUE) +
scale_fill_viridis(discrete = TRUE) +
ylab("Imports of beef and veal (carcass weight, 1,000 pounds)") +
scale_x_continuous(breaks = seq(1990, 2015, by = 5)) +
theme_bw() + mytheme +
guides(col = guide_legend(ncol = 2)) +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.15, 0.9),
legend.direction = "vertical",
legend.text=element_text(size=10)) +
expand_limits(x = 1990, y = 0)
beef_export <- ggplot(dta, aes(x = year, y = value, color = Country, fill = Country)) +
geom_area(position = "stack") +
geom_line(position = "stack", size = 0.5, color = "black") +
scale_color_viridis(discrete = TRUE) +
scale_fill_viridis(discrete = TRUE) +
ylab("Imports of beef and veal (carcass weight, 1,000 pounds)") +
scale_x_continuous(breaks = seq(1990, 2015, by = 5)) +
theme_bw() + mytheme +
guides(col = guide_legend(ncol = 2)) +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.15, 0.9),
legend.direction = "vertical",
legend.text=element_text(size=10)) +
scale_y_continuous(expand = c(0,0))
beef_export
ggplot(dta, aes(x = year, y = value, color = Country, fill = Country)) +
geom_area(position = "stack") +
geom_line(position = "stack", size = 0.5, color = "black") +
scale_color_viridis(discrete = TRUE) +
scale_fill_viridis(discrete = TRUE) +
ylab("Imports of beef and veal (carcass weight, 1,000 pounds)") +
scale_x_continuous(breaks = seq(1990, 2015, by = 5), expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
theme_bw() + mytheme +
guides(col = guide_legend(ncol = 2)) +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.15, 0.9),
legend.direction = "vertical",
legend.text=element_text(size=10))
dta <- read_excel("Data/7) Cattle prices.xlsx", sheet = "Data sheet (machine readable)")
dta <- dta %>%
dplyr::filter(Description == "65-80% Choice") %>%
dplyr::select(Date, Value) %>%
mutate(Date = as.Date(Date),
var = "Live cattle, 65-80% Choice ($/cwt, live basis)")
dta2 <- read_excel("Data/7) Beef prices.xls", sheet = "historical", skip = 4, col_names = FALSE) %>%
dplyr::select(X__1, X__2) %>%
rename(Date = X__1, Value = X__2) %>%
mutate(Date = as.Date(Date),
var = "Boxed beef, Choice 1-3 ($/cwt, carcass)")
dta <- rbind(dta, dta2)
plot_price <- ggplot(dta, aes(x = Date, y = Value, color = var)) +
geom_line(size = 1) +
scale_color_manual(values = viridis(3)[c(1,2)]) +
ylab("Price ($/cwt)") +
scale_x_date(date_breaks = "1 year", date_labels = "%Y", expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.text.x=element_text(size = 10),
axis.line = element_line(color='black'),
legend.position = c(0.3, 0.9),
legend.direction = "vertical")
plot_price
