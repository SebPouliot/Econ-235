ungroup()
dta
plot_exports <- ggplot(dta, aes(x = year, y = value, fill = country)) +
geom_area(position = "stack", alpha = 0.75) +
geom_line(position = "stack", size = 0.5, color = "black") +
scale_fill_manual(values = viridis(6)[c(1:5)]) +
ylab("Exports of eggs (Shell egg equivalent, 1,000 dozen)") +
scale_x_continuous(breaks = seq(2000, 2018, by = 2), expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.15, 0.9),
legend.direction = "vertical")
plot_exports
plot_exports <- ggplot(dta, aes(x = year, y = value, fill = country)) +
geom_area(position = "stack", alpha = 0.75) +
geom_line(position = "stack", size = 0.5, color = "black") +
scale_fill_manual(values = viridis(6)[c(1:5)]) +
ylab("Exports of eggs (Shell egg equivalent, 1,000 dozen)") +
scale_x_continuous(breaks = seq(2000, 2018, by = 2), expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
theme_bw() + mytheme +
theme(axis.title.x=element_blank(),
axis.line = element_line(color='black'),
legend.position = c(0.15, 0.75),
legend.direction = "vertical")
plot_exports
year0 <- 2010 #Can go as far back as 2000
year1 <- 2018
month0 <- "01"
month1 <- "12"
day0 <- "01"
day1 <- "31"
for (y0 in year0:year1){
year0 <- y0
y1 <- year0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(year0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
colnames(dta2) <- c("date", "region", "type", "form", "description", "stores", "avg_price", "low_price", "high_price")
dta2$date <- as.Date(dta2$date, "%m/%d/%Y")
dta2 <- dta2[!is.na(dta2$date),]
#Merge the data
ifelse("dta" %in% ls(), dta <- rbind(dta, dta2), dta <- dta2)
#Remove duplicates
dta <- dta[!duplicated(dta),]
}
dta <- dta %>% arrange(date)
i
y0
year0 <- y0
y1 <- year0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(year0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(year0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
year0 <- y0
y1 <- year0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(year0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2
read_fwf
?read_fwf
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
dta2
colnames(dta2) <- c("date", "region", "type", "form", "description", "stores", "avg_price", "low_price", "high_price")
rm(dta)
ifelse("dta" %in% ls(), dta <- rbind(dta, dta2), dta <- dta2)
#Remove duplicates
dta <- dta[!duplicated(dta),]
year0 <- 2010 #Can go as far back as 2000
year1 <- 2018
month0 <- "01"
month1 <- "12"
day0 <- "01"
day1 <- "31"
rm(dta)
for (y0 in year0:year1){
year0 <- y0
y1 <- year0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(year0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
colnames(dta2) <- c("date", "region", "type", "form", "description", "stores", "avg_price", "low_price", "high_price")
dta2$date <- as.Date(dta2$date, "%m/%d/%Y")
dta2 <- dta2[!is.na(dta2$date),]
#Merge the data
ifelse("dta" %in% ls(), dta <- rbind(dta, dta2), dta <- dta2)
#Remove duplicates
dta <- dta[!duplicated(dta),]
}
dta <- dta %>% arrange(date)
dta
?write.xls
?write.xlsx
pacman::p_load(xlsx)
?write.xlsx
write.xlsx("Data/8) Egg retail prices.xlsx", row.names = FALSE)
write.xlsx(dta, "Data/8) Egg retail prices.xlsx", row.names = FALSE)
dta
View(dta)
write.xlsx(data.frame(dta), "Data/8) Egg retail prices.xlsx", row.names = FALSE)
rm(dta)
for (y0 in year0:year1){
year0 <- y0
y1 <- year0+1
link0 <- paste("https://marketnews.usda.gov/mnp/py-report?&endYear=2015&repDate=", month0, "%2F", day0, "%2F", year0, "&repMonth=1&repYear=2015&previouscls=Breaking+Stock&endDate=", month1, "%2F", day1, "%2F", year1, "&frequency=Daily&categoryDesc=Egg&run=Run&category=Egg&_producttypefrom=1&subcategory=Shell+Eggs&runReport=true&_producttype=1&report=NW_PY018&commodityDesc=Shell+Eggs&datatype=None+Selected&regionsDesc=&endMonth=1&producttypefrom=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
colnames(dta2) <- c("date", "class", "grade", "market", "delivery", "unit", "low_price", "high_price", "mostly_low", "mostly_high")
dta2$date <- as.Date(dta2$date, "%m/%d/%Y")
dta2 <- dta2[!is.na(dta2$date),]
#Merge the data
ifelse("dta" %in% ls(), dta <- rbind(dta, dta2), dta <- dta2)
#Remove duplicates
dta <- dta[!duplicated(dta),]
}
#Remove duplicates
dta <- dta[!duplicated(dta),]
dta <- dta %>% arrange(date)
write.xlsx(data.frame(dta), "Data/8) Egg wholesale prices.xlsx", row.names = FALSE)
dta
View(dta)
View(dta)
colnames(dta)
is.na(colnames(dta))
colnames(dta)[!is.na(colnames(dta))]
dta <- dta[,colnames(dta)[!is.na(colnames(dta))]]
dta <- dta %>% arrange(date)
write.xlsx(data.frame(dta), "Data/8) Egg wholesale prices.xlsx", row.names = FALSE)
rm(dta)
for (y0 in year0:year1){
year0 <- y0
y1 <- year0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report?&endYear=", y1, "&repDate=", month0, "%2F", day0, "%2F", year0, "&repMonth=1&repYear=", year0, "&previouscls=Liquid&endDate=", month1, "%2F", day1, "%2F", y1, "&frequency=Weekly&categoryDesc=Egg&run=Run&category=Egg&_producttypefrom=1&subcategory=Breaking+Stock&runReport=true&_producttype=1&report=NW_PY023&commodityDesc=Breaking+Stock&datatype=None+Selected&regionsDesc=&endMonth=1&producttypefrom=&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=3)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
colnames(dta2) <- c("date", "region", "class", "volume", "unit", "diff")
dta2$date <- as.Date(dta2$date, "%m/%d/%Y")
dta2 <- dta2[!is.na(dta2$date),]
#Merge the data
ifelse("dta" %in% ls(), dta <- rbind(dta, dta2), dta <- dta2)
#Remove duplicates
dta <- dta[!duplicated(dta),]
}
dta <- dta %>% arrange(date)
dta
year0
year0 <- 2010 #Can go as far back as 2000
year1 <- year(Sys.date())
Sys.time()
year(Sys.time())
year0 <- 2010 #Can go as far back as 2000
year1 <- year(Sys.time())
rm(dta)
for (y0 in year0:year1){
year0 <- y0
y1 <- year0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report?&endYear=", y1, "&repDate=", month0, "%2F", day0, "%2F", year0, "&repMonth=1&repYear=", year0, "&previouscls=Liquid&endDate=", month1, "%2F", day1, "%2F", y1, "&frequency=Weekly&categoryDesc=Egg&run=Run&category=Egg&_producttypefrom=1&subcategory=Breaking+Stock&runReport=true&_producttype=1&report=NW_PY023&commodityDesc=Breaking+Stock&datatype=None+Selected&regionsDesc=&endMonth=1&producttypefrom=&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=3)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
colnames(dta2) <- c("date", "region", "class", "volume", "unit", "diff")
dta2$date <- as.Date(dta2$date, "%m/%d/%Y")
dta2 <- dta2[!is.na(dta2$date),]
#Merge the data
ifelse("dta" %in% ls(), dta <- rbind(dta, dta2), dta <- dta2)
#Remove duplicates
dta <- dta[!duplicated(dta),]
}
dta <- dta %>% arrange(date)
dta$volume <- as.numeric(gsub(",","", dta$volume))
write.xlsx(data.frame(dta), "Data/8) Egg stocks.xlsx", row.names = FALSE)
dta <- read_excel("Data/8) Egg retail prices.xlsx", sheet = 1)
dta
dta_shell <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "SHELL", description %in% c("WHITE, A, LARGE, DOZ.")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(`White A large shell egg ($/doz)` = avg_price)
dta_liquid <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "LIQUID", description %in% c("LIQUID EGG, SMALL CARTON")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(`Liquid egg ($/small carton)` = avg_price)
dta_liquid
dta_shell
dta_shell <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "SHELL", description %in% c("WHITE, A, LARGE, DOZ.")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "White A large shell egg ($/doz)")
dta_shell
dta_liquid <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "LIQUID", description %in% c("LIQUID EGG, SMALL CARTON")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "Liquid egg ($/small carton)")
dta <- rbind(dta_shell, dta_liquid)
dta
ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=variable), size=1.25)
ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25)
ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y"))
dta <- rbind(dta_shell, dta_liquid) %>%
mutate(date = as.Date(date))
ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y"))
ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(legend.position=c(0.25,0.85),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(legend.position=c(0.15,0.85),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- ggplot(data=dta, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
dta <- read_excel("Data/8) Egg wholesale prices")
dta <- read_excel("Data/8) Egg wholesale prices.xlsx")
dta
dta %>%
dplyr::select(1:10) %>%
dplyr::filter(class == "LARGE",market == "IOWA-MINNESOTA-WISCONSIN", delivery == "PAID TO PRODUCERS") %>%
mutate(avg_price = (mostly_low+mostly_high)/200)
dta_w <- dta %>%
dplyr::select(1:10) %>%
dplyr::filter(class == "LARGE",market == "IOWA-MINNESOTA-WISCONSIN", delivery == "PAID TO PRODUCERS") %>%
mutate(avg_price = (mostly_low+mostly_high)/200)
ggplot(data=dta_w, aes(x=date, y=avg_price)) +
geom_point(size=1.25)
year0
dta <- read_excel("Data/8) Egg wholesale prices.xlsx")
dta_w <- dta %>%
dplyr::select(1:10) %>%
dplyr::filter(class == "LARGE",market == "IOWA-MINNESOTA-WISCONSIN", delivery == "PAID TO PRODUCERS") %>%
mutate(avg_price = (mostly_low+mostly_high)/200)
plot <- ggplot(data=dta_w, aes(x=date, y=avg_price)) +
geom_point(size=1.25) +
ylab("Price ($/dozen)") +
xlab("") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
dta <- read_excel("Data/8) Egg wholesale prices.xlsx")
dta_w <- dta %>%
dplyr::select(1:10) %>%
dplyr::filter(class == "LARGE",market == "IOWA-MINNESOTA-WISCONSIN", delivery == "PAID TO PRODUCERS") %>%
mutate(avg_price = (mostly_low+mostly_high)/200,
date = as.Date(date))
plot <- ggplot(data=dta_w, aes(x=date, y=avg_price)) +
geom_point(size=1.25) +
ylab("Price ($/dozen)") +
xlab("") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
ggplot(data=dta_w, aes(x=date, y=avg_price)) +
geom_point(size=1.25) +
ylab("Price ($/dozen)") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- ggplot(data=dta_w, aes(x=date, y=avg_price)) +
geom_point(size=1.25) +
ylab("Price ($/dozen)") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
dta <- read_excel("Data/8) Egg stocks.xlsx")
dta
dta <- read_excel("Data/8) Egg stocks.xlsx")
dta <- dta %>%
mutate(date = as.Date(date),
volume = volume/1000000)
plot <- ggplot(data=dta, aes(x=date, y=volume)) +
geom_point(size=0.5) +
ylab("Stock (million pound)") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme  +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
year0 <- 2010 #Can go as far back as 2000
year1 <- year(Sys.time())
if(Sys.time() - file.info("Data/8) Egg retail prices.xlsx")$mtime > months(6, abbreviate = FALSE)){
source("R code/8) Egg prices.R")
}
dta <- read_excel("Data/8) Egg retail prices.xlsx", sheet = 1)
dta_shell <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "SHELL", description %in% c("WHITE, A, LARGE, DOZ.")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "White A large shell egg ($/doz)")
dta_liquid <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "LIQUID", description %in% c("LIQUID EGG, SMALL CARTON")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "Liquid egg ($/small carton)")
dta_r <- rbind(dta_shell, dta_liquid) %>%
mutate(date = as.Date(date))
plot <- ggplot(data=dta_r, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
dta <- read_excel("Data/8) Egg wholesale prices.xlsx")
dta_w <- dta %>%
dplyr::select(1:10) %>%
dplyr::filter(class == "LARGE",market == "IOWA-MINNESOTA-WISCONSIN", delivery == "PAID TO PRODUCERS") %>%
mutate(avg_price = (mostly_low+mostly_high)/200,
date = as.Date(date))
plot <- ggplot(data=dta_w, aes(x=date, y=avg_price)) +
geom_point(size=1.25) +
ylab("Price ($/dozen)") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
dta_w
dta_r
dta_w
dta_w <- dta_w %>%
mutate(var = "Price paid to producers ($/doz)") %>%
dplyr::select(date, price, var)
colnames(dta_w)
dta_w <- dta_w %>%
mutate(var = "Price paid to producers ($/doz)") %>%
rename(price = avg_price) %>%
dplyr::select(date, price, var)
dta_w
dta <- rbind(dta_r, dta_w)
ggplot(data=dta, aes(x=date, y=price, color = var)) +
geom_point(size=1.25)
dta_r
dta_r <- dta_r %>%
dplyr::filter(var == "White A large shell egg ($/doz)")
plot <- ggplot(data=dta, aes(x=date, y=price, color = var)) +
geom_point(size=1.25) +
ylab("Price ($/dozen)") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
dta <- rbind(dta_r, dta_w)
plot <- ggplot(data=dta, aes(x=date, y=price, color = var)) +
geom_point(size=1.25) +
ylab("Price ($/dozen)") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
year0 <- 2010 #Can go as far back as 2000
year1 <- year(Sys.time())
source("R code/8) Egg prices.R")
source("R code/8) Egg prices.R")
dta <- read_excel("Data/8) Egg retail prices.xlsx", sheet = 1)
dta_shell <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "SHELL", description %in% c("WHITE, A, LARGE, DOZ.")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "White A large shell egg ($/doz)")
dta_liquid <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "LIQUID", description %in% c("LIQUID EGG, SMALL CARTON")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "Liquid egg ($/small carton)")
dta_r <- rbind(dta_shell, dta_liquid) %>%
mutate(date = as.Date(date))
View(dta_r)
year0 <- 2014 #Can go as far back as 2000
year1 <- 2018
month0 <- "01"
month1 <- "12"
day0 <- "01"
day1 <- "31"
y1 <- y0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(y0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
dta2
View(dta2)
colnames(dta2) <- c("date", "region", "type", "form", "description", "stores", "avg_price", "low_price", "high_price")
y0 <- 2014
y1 <- y0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(y0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2 <- dta2[ , ! apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
dta
dta2
View(dta2)
colnames(dta2) <- c("date", "region", "type", "form", "description", "stores", "avg_price", "low_price", "high_price")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2)
dta2[,6:ncol(dta2)] <- dta2[,6:ncol(dta2)][ , !apply(dta2[,6:ncol(dta2)] , 2 , function(x) all(as.numeric(x)) ) ]
dta2[,6:ncol(dta2)]
for (i in 6:ncol(dta2)){dta2[,i] <- as.numeric(dta2[,i])
}
dta2[,i]
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2) %>% data.frame
for (i in 6:ncol(dta2)){dta2[,i] <- as.numeric(dta2[,i])}
dta2
dta2 <- dta2[ , !apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
colnames(dta2) <- c("date", "region", "type", "form", "description", "stores", "avg_price", "low_price", "high_price")
year0
year0 <- 2010
rm(dta)
month0 <- "01"
month1 <- "12"
day0 <- "01"
day1 <- "31"
rm(dta)
for (y0 in year0:year1){
y1 <- y0+1
link0 <- paste("https://www.marketnews.usda.gov/mnp/py-report-retail?&region=ALL&repDate=", month0, "%2F", day0, "%2F", as.character(y0), "&repType=item&portal=py&state=ALL&class=Retail&endDate=", month1,"%2F", day1, "%2F", as.character(y1), "&type=ALL&dataValue=&operator=%3C&dataType=None+Selected&commodity=EGGS&runReport=true&description=ALL&format=text", sep="")
dta2 <- read_fwf(link0, fwf_empty(link0), skip=2) %>% data.frame
for (i in 6:ncol(dta2)){dta2[,i] <- as.numeric(dta2[,i])}
dta2 <- dta2[ , !apply(dta2 , 2 , function(x) all(is.na(x)) ) ]
colnames(dta2) <- c("date", "region", "type", "form", "description", "stores", "avg_price", "low_price", "high_price")
dta2 <- dta2[,colnames(dta2)[!is.na(colnames(dta2))]]
dta2$date <- as.Date(dta2$date, "%m/%d/%Y")
dta2 <- dta2[!is.na(dta2$date),]
#Merge the data
ifelse("dta" %in% ls(), dta <- rbind(dta, dta2), dta <- dta2)
#Remove duplicates
dta <- dta[!duplicated(dta),]
}
dta <- dta %>% arrange(date)
write.xlsx(data.frame(dta), "Data/8) Egg retail prices.xlsx", row.names = FALSE)
dta <- read_excel("Data/8) Egg retail prices.xlsx", sheet = 1)
dta_shell <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "SHELL", description %in% c("WHITE, A, LARGE, DOZ.")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "White A large shell egg ($/doz)")
dta_liquid <- dta %>%
filter(region == "NATIONAL", type == "CONVENTIONAL", form == "LIQUID", description %in% c("LIQUID EGG, SMALL CARTON")) %>%
dplyr::select(-region, -type, -form, -low_price, -high_price, -description, -stores) %>%
rename(price = avg_price) %>%
mutate(var = "Liquid egg ($/small carton)")
dta_r <- rbind(dta_shell, dta_liquid) %>%
mutate(date = as.Date(date))
plot <- ggplot(data=dta_r, aes(x=date, y=price, color=var)) +
geom_point(aes(shape=var), size=1.25) +
ylab("Price") +
scale_x_date(date_breaks="1 year", date_minor_breaks="1 months", labels=date_format("%Y")) +
theme_bw()+ mytheme +
theme(axis.title.x=element_blank(),
legend.position=c(0.20,0.90),
axis.line.x = element_line(color='black'),
axis.line.y = element_line(color='black'))
plot <- plot + geom_smooth(se = FALSE, span=0.25)
plot
